{% extends 'base.html' %}

{% block title %}Form{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center">{% if object %}Edit Blog: {{ object.title }}{% else %}Create New Blog{% endif %}</h2>
    {% if request.user.is_authenticated %}
    <form method="post">
        {% csrf_token %}
        
        <div class="mb-3">
            <label for="id_title" class="form-label">Title:</label>
            {{ form.title }}  <!-- Render the title field -->
        </div>

        <div class="mb-3">
            <label for="id_context" class="form-label">Content:</label>
            {{ form.context }}  <!-- Render the content field -->
        </div>

        <div class="mb-5">
            <label>Tags:</label>
            <div id="tag-buttons">
                {% for tag in tags %}
                    <label class="btn btn-outline-primary {% if tag.id in selected_tags %}active{% endif %}">
                        <input type="checkbox" name="tags" value="{{ tag.id }}" class="d-none"
                            {% if tag.id in selected_tags %}checked{% endif %}>
                        {{ tag.name }}
                    </label>
                {% endfor %}
            </div>
            <small class="form-text text-muted">Hold down the Ctrl (Windows) or Command (Mac) button to select multiple options.</small>
        </div>

        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-success">{% if object %}Update Blog{% else %}Create Blog{% endif %}</button>
            <a href="{% url 'blog-list' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
    {% else %}
    <p>You must be logged in to create or edit blog posts.</p>
    {% endif %}
</div>

<script>
    // JavaScript to handle the toggling of tag button state
    document.querySelectorAll('#tag-buttons .btn').forEach(button => {
        button.addEventListener('click', function(event) {
            event.preventDefault();  // Prevent the default label click behavior
            this.classList.toggle('active');  // Toggle the active class

            const input = this.querySelector('input');  // Get the hidden checkbox input
            input.checked = !input.checked;  // Toggle the checked state of the checkbox
        });
    });
</script>
{% endblock %}
